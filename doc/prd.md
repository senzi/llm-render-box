# 产品需求文档 (PRD): LLM-HTML-Runner (本地代码预览工坊)

| 文档版本 | V1.0 |
| :--- | :--- |
| **状态** | 待开发 |
| **技术栈** | Vue 3 + Vite + Pinia + IndexedDB + Snapdom |

用bun，项目目前已经执行过 bun create vite . --template vue ，直接按需构建代码即可。
写完代码不要申请bun dev等命令，开发服务器我会自己开。

## 1\. 项目背景与目标

随着 LLM 生成前端代码的能力增强，用户经常需要验证和保存 LLM 生成的 HTML 单页应用。本项目旨在提供一个**纯前端、本地优先、无后端**的轻量级管理工具。用户可以快速新建、粘贴代码、实时预览、截图保存，并以类似“浏览器起始页”的网格形式管理这些微型应用。

## 2\. 核心用户流程

1.  **进入首页**：看到过往保存的页面卡片列表。
2.  **新建/导入**：点击“+”号新建，或拖入 `.html` 文件/备份 `.json` 文件。
3.  **编辑代码**：在编辑器中粘贴 LLM 生成的代码。
4.  **预览调试**：点击预览，查看运行效果。
5.  **截图留档**：一键生成运行截图并下载，同时更新首页缩略图。
6.  **数据带走**：随时导出所有数据到本地。

## 3\. 功能详情

### 3.1 首页 (Dashboard)

**页面布局**：

  * **大标题**：应用名称（自定义或默认，如 "My Snippets"）。
  * **安全提示**：在页面显著但不打扰的位置（如标题下方小字），提示：“本应用为纯本地运行，请确保您粘贴的代码来源可靠，自行承担运行风险。”
  * **页面列表（Grid 布局）**：
      * 展示已保存页面的缩略图卡片。
      * **卡片内容**：缩略图（若无则显示默认占位图）、页面标题、创建时间。
      * **卡片操作**：点击进入编辑页；卡片角标提供“删除”功能。
      * **新建按钮**：列表末尾始终显示一个带 “+” 号的卡片，点击跳转至空白编辑页。
  * **底部/角落浮动操作区**：
      * **导出数据**：将所有页面数据打包下载为 `.json` 文件。

**交互逻辑**：

  * **拖拽导入**：
      * 用户将文件拖入首页任意区域（覆盖全屏 Dropzone）。
      * **识别逻辑**：
          * 若为 `.html`：自动解析文件内容，新建一个页面条目，文件名为标题，内容为代码。
          * 若为特定格式的 `.json`（本应用导出的备份）：执行数据恢复/合并操作。
      * 导入成功后，列表自动刷新。

### 3.2 编辑与预览页 (Workspace)

**页面布局**：包含“顶部工具栏”和“主内容区”。

#### 3.2.1 顶部工具栏 (Toolbar)

高度紧凑，样式克制。

  * **左侧**：`<` 返回按钮。点击返回首页（自动保存当前修改）。
  * **中间**：页面标题输入框。用户可点击修改，失去焦点自动保存。
  * **右侧**：
      * **状态 A（编辑模式）**：显示 `[ ▶ 预览 ]` 按钮。
      * **状态 B（预览模式）**：显示 `[ ⏹ 停止 ]` 按钮 和 `[ 📷 截图 ]` 按钮。

#### 3.2.2 主内容区 - 编辑模式

  * 全屏代码编辑区域。
  * **组件建议**：使用 `Codemirror` 或类似轻量组件，提供基础的 HTML 语法高亮和行号，提升粘贴和阅读体验。
  * 支持 `Ctrl + S` 快捷键保存（虽然有自动保存，但为了符合用户习惯）。

#### 3.2.3 主内容区 - 预览模式

  * **容器**：全屏 `<iframe>`。
  * **渲染机制**：使用 `srcdoc` 属性注入用户代码，确保沙箱隔离。
  * **权限控制**：`sandbox="allow-scripts allow-forms allow-popups allow-modals"` (暂不开启 `allow-same-origin` 以避免 cookie 泄露风险，除非涉及特定本地存储需求)。

### 3.3 截图功能 (Snapdom 集成)

  * **触发时机**：仅在“预览模式”下点击 `[ 📷 截图 ]` 按钮触发。
  * **执行逻辑**：
    1.  调用 `snapdom` 库。
    2.  **Target**：指向 iframe 内部的 `document.body`，**严禁**截取到外层的顶部工具栏。
    3.  **动作 1 (下载)**：自动触发浏览器下载行为，文件名格式：`Title_Timestamp.png`。
    4.  **动作 2 (更新封面)**：将生成的图片 Blob 压缩（建议宽度压缩至 300px 左右）并转为 Base64 或 Blob 存入 IndexedDB，更新当前页面的 `thumbnail` 字段。
  * **代码参考**：
    ```javascript
    // 伪代码逻辑
    const iframe = document.getElementById('preview-frame');
    const iframeBody = iframe.contentDocument.body;

    // 使用 snapdom 截图
    const result = await snapdom(iframeBody);

    // 1. 下载原图
    await result.download({ 
        format: 'png', 
        filename: `${currentTitle}_capture` 
    });

    // 2. 生成缩略图用于更新数据库
    const blob = await result.toBlob();
    updatePageThumbnail(pageId, blob); 
    ```

## 4\. 数据结构与存储 (IndexedDB)

**数据库名**：`LLMRunnerDB`
**ObjectStore**：`pages`

**字段定义**：

```json
{
  "id": "uuid-v4-string",        // 唯一标识
  "title": "String",             // 页面标题
  "code": "String",              // HTML 源码
  "thumbnail": "Blob/Base64",    // 缩略图数据 (可为空)
  "createdAt": "Timestamp",      // 创建时间
  "updatedAt": "Timestamp"       // 更新时间
}
```

  * **导出格式**：JSON 文件，包含 `pages` 数组。
  * **导入逻辑**：
      * 读取 JSON，遍历数组。
      * 如果 `id` 已存在，提示覆盖或自动重命名生成新 ID（建议简便起见，直接生成新 ID 作为副本导入）。

## 5\. 非功能性需求 (NFR)

1.  **性能**：
      * 首页加载速度 \< 1s。
      * 引入 `localforage` 或 `dexie.js` 操作 IndexedDB，避免主线程阻塞。
      * 编辑器代码量大时（\>5000行）不应明显卡顿。
2.  **兼容性**：
      * Chrome / Edge / Firefox / Safari 最新版。
      * 桌面端为主，暂不强制适配移动端编辑体验。
3.  **安全性**：
      * 利用 Iframe `sandbox` 属性防止恶意脚本跳出沙箱攻击主应用。
      * 不自行设立后端服务器，所有数据只在用户浏览器闭环。

## 6\. UI/UX 风格指南

  * **风格**：极简主义 (Minimalist)，类似 Vercel 或 Notion 风格。
  * **色调**：黑白灰为主，强调色用蓝色或紫色（Vite 风格）。
  * **交互**：
      * 按钮要有明显的 Hover 态。
      * 截图成功要有轻微的 Toast 提示（如“截图已下载”）。
      * 拖拽文件进入首页时，要有明显的虚线框高亮提示“释放以导入”。